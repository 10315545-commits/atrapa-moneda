<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Atrapa la Moneda V10.2 Owner</title>
<style>
body{
  margin:0;
  background: linear-gradient(to bottom,#0f0f0f,#1a1a2e);
  color:white;
  font-family: Arial, sans-serif;
  text-align:center;
  overflow-x:hidden;
}
h1{
  color:#00ffcc;
  text-shadow:0 0 15px #00ffcc,0 0 25px #00ffaa;
}
button{
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  margin:5px;
  font-weight:bold;
  color:white;
  background: linear-gradient(145deg, #222233, #444466);
  box-shadow: 0 0 10px #00ffcc;
  transition: all 0.2s ease;
}
button:hover{
  background: linear-gradient(145deg,#00ffcc,#00aa88);
  box-shadow: 0 0 15px #00ffcc;
  color:#0f0f0f;
}
#game, #adminPanel{
  display:none;
  background: linear-gradient(to bottom,#111122,#222244);
  padding:15px;
  border-radius:12px;
  box-shadow:0 0 15px #00ffcc;
  margin:10px auto;
  max-width: 400px;
}
#moneda{
  font-size:80px;
  margin:20px;
  text-shadow:0 0 10px #ffff66;
}
.info{
  font-size:18px;
  margin:5px;
}
.fallingCoin,.diamond,.bossCoin,.miniBoss{
  position:absolute;
  top:-50px;
  user-select:none;
  pointer-events:none;
}
.fallingCoin{ font-size:40px; color:yellow; animation:caer 2s forwards ease-in;}
.diamond{ font-size:35px; color:#00ffff; animation:caer 2s forwards ease-in;}
.bossCoin{ font-size:50px; color:#ff44cc; animation:caer 2.2s forwards ease-in;}
.miniBoss{ font-size:45px; color:#ffbb33; animation:caer 2.5s forwards ease-in;}
@keyframes caer{
  0% {top:-50px; opacity:1;}
  80% {top:80vh; transform:translateY(-10px);}
  100% {top:85vh; opacity:0; transform:translateY(0);}
}
#eventHistory{
  max-height:180px;
  overflow-y:auto;
  border:1px solid #00ffcc;
  margin-top:5px;
  padding:5px;
  font-size:14px;
  text-align:left;
  background:#111122;
  border-radius:8px;
}
.eventItem{
  cursor:pointer;
  margin:2px 0;
}
.eventItem:hover{
  background:#00ffcc;
  color:#0f0f0f;
  border-radius:5px;
}
#ranking{
  max-height:100px;
  overflow-y:auto;
  border:1px solid #00ffcc;
  margin-top:5px;
  padding:5px;
  font-size:14px;
  background:#111122;
  border-radius:8px;
  text-align:left;
}
#messages,#ownerMessages{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background: rgba(0,0,0,0.7);
  padding:10px 20px;
  border-radius:12px;
  color:#fff;
  font-weight:bold;
  display:none;
  z-index:1000;
}
#ownerMessages{
  top:60px;
  background:#8800ff;
}
</style>
</head>
<body>

<h1>üéÆ ATRAPA LA MONEDA V10.2 Owner</h1>

<div id="menu">
  <button onclick="iniciar()">INICIAR JUEGO</button>
  <button onclick="showAdmin()" id="adminBtn">Admin Panel</button>
  <input type="color" id="userSkin" value="#00ffcc" onchange="applySkin(this.value)">
</div>

<div id="game">
  <h2 id="moneda">‚ùì</h2>
  <p>Presiona L, C o R</p>
  <div class="info" id="stats"></div>
  <div id="ranking"></div>
</div>

<div id="adminPanel">
  <h3>ADMIN PANEL (Owner)</h3>
  <button onclick="triggerEvent('party',true)">Party</button>
  <button onclick="triggerEvent('clear',true)">Clear Coins</button>
  <button onclick="triggerEvent('rainDiamonds',true)">Rain Diamonds</button>
  <button onclick="toggleInfiniteLife()">Vida Infinita</button>
  <button onclick="ownerMessagePrompt()">Enviar Mensaje Owner</button>
  <div id="eventHistory"></div>
</div>

<div id="messages"></div>
<div id="ownerMessages"></div>

<audio id="coinSound" src="https://freesound.org/data/previews/341/341695_624578-lq.mp3"></audio>
<audio id="bossSound" src="https://freesound.org/data/previews/186/186942_351137-lq.mp3"></audio>
<audio id="diamondSound" src="https://freesound.org/data/previews/276/276020_5121236-lq.mp3"></audio>

<script>
let pesos = 0;
let vidas = 5;
let infiniteLife = false;
let record = localStorage.getItem("record") || 0;
let secuencia = ["R","L","C","L","R","C","R"];
let indice = 0;
let monedaActual = "";
let velocidad = 1500;
let intervalo;
let rankingList = [];

const monedaEl = document.getElementById("moneda");
const statsEl = document.getElementById("stats");
const adminPanel = document.getElementById("adminPanel");
const eventHistory = document.getElementById("eventHistory");
const rankingEl = document.getElementById("ranking");
const messagesEl = document.getElementById("messages");
const ownerMessagesEl = document.getElementById("ownerMessages");

const coinSound = document.getElementById("coinSound");
const bossSound = document.getElementById("bossSound");
const diamondSound = document.getElementById("diamondSound");

const ownerClass = "ruler"; 
let userSkinColor = "#00ffcc";

// --- Skin ---
function applySkin(color){
  userSkinColor = color;
  document.querySelectorAll('button').forEach(btn=>{
    btn.style.boxShadow = "0 0 10px "+color;
  });
  monedaEl.style.textShadow = "0 0 10px "+color;
}

// --- Game Start ---
function iniciar(){
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  resetGame();
  spawnMiniBosses();
  startDailyEvents();
}

// --- Game Reset ---
function resetGame(){
  pesos = 0;
  vidas = 5;
  velocidad = 1500;
  indice = 0;
  actualizarStats();
  nuevaMoneda();
  clearInterval(intervalo);
  intervalo = setInterval(tiempoAgotado, velocidad);
}

// --- New Coin ---
function nuevaMoneda(){
  monedaActual = secuencia[indice];
  monedaEl.innerText = monedaActual;
  crearMoneda(monedaActual);
  indice++;
  if(indice >= secuencia.length) indice=0;
}

// --- Stats & Ranking ---
function actualizarStats(){
  statsEl.innerText =
    "Pesos: " + pesos +
    " | Vidas: " + (infiniteLife ? "‚àû" : vidas) +
    " | R√©cord: " + record;
  actualizarRanking();
}

function actualizarRanking(){
  rankingEl.innerHTML = "Ranking: <br>"+rankingList.slice(-5).reverse().map((v,i)=> (i+1)+". "+v).join("<br>");
}

// --- Time Up ---
function tiempoAgotado(){
  if(!infiniteLife) vidas--;
  actualizarStats();
  if(vidas <= 0) gameOver();
  nuevaMoneda();
}

// --- Game Over ---
function gameOver(){
  clearInterval(intervalo);
  if(pesos > record){
    record = pesos;
    localStorage.setItem("record", record);
  }
  rankingList.push(pesos);
  showMessage("GAME OVER! Puntaje: "+pesos,2000);
  resetGame();
}

// --- Key Press ---
document.addEventListener("keydown", function(e){
  const eleccion = e.key.toUpperCase();
  if(!["L","C","R"].includes(eleccion)) return;

  if(eleccion === monedaActual){
    pesos++;
    coinSound.play();
    velocidad -= 50;
    if(velocidad < 500) velocidad = 500;
    clearInterval(intervalo);
    intervalo = setInterval(tiempoAgotado, velocidad);
  } else {
    if(!infiniteLife) vidas--;
  }

  actualizarStats();
  if(vidas <= 0) gameOver();
  nuevaMoneda();
});

// --- Mini Bosses ---
function spawnMiniBosses(){
  setInterval(()=>{
    if(Math.random()<0.08){
      const mb = document.createElement("div");
      mb.className = "miniBoss";
      mb.innerText = "üëæ";
      mb.style.left = Math.random()*90+"vw";
      mb.style.animationDuration = (2+Math.random()*1)+"s";
      document.body.appendChild(mb);

      let attacked = false;
      const attackTimeout = setTimeout(()=>{
        if(!attacked && !infiniteLife){
          vidas--;
          showMessage("MiniBoss atac√≥! -1 vida",2000);
          actualizarStats();
        }
        mb.remove();
      },2500);

      mb.onclick = ()=>{
        attacked = true;
        pesos += 5;
        coinSound.play();
        actualizarStats();
        showMessage("MiniBoss atrapado +5 monedas",2000);
        clearTimeout(attackTimeout);
        mb.remove();
      };
    }
  },1000);
}

// --- Coins & Diamonds ---
function crearMoneda(tipo){
  const coin = document.createElement("div");
  if(tipo==="C"){ coin.className = "fallingCoin"; coin.innerText = "ü™ô"; }
  if(tipo==="R"){ coin.className = "bossCoin"; coin.innerText = "üí∞"; }
  if(tipo==="diamond"){ coin.className = "diamond"; coin.innerText = "üíé"; }

  coin.style.left = Math.random()*90+"vw";
  coin.style.animationDuration = (2+Math.random()*1)+"s";
  coin.style.textShadow = "0 0 10px "+userSkinColor+",0 0 20px #fff";
  document.body.appendChild(coin);

  setTimeout(()=>{
    coin.remove();
    if(tipo==="R") bossSound.play();
    else if(tipo==="diamond") diamondSound.play();
    else coinSound.play();
  },3500);
}

// --- Admin Panel ---
function showAdmin(){
  if(ownerClass !== "ruler") return alert("Solo el owner puede abrir este panel");
  adminPanel.style.display = adminPanel.style.display==="block" ? "none" : "block";
}

// --- Events ---
function triggerEvent(event, isAdmin=false){
  if(event === "party"){
    for(let i=0;i<10;i++) crearMoneda("C");
    pesos += isAdmin ? 10 : 5;
    logEvent("Party activado +" + (isAdmin?10:5) + " monedas", isAdmin);
  }
  if(event === "clear"){
    const coins = document.querySelectorAll(".fallingCoin,.diamond,.bossCoin,.miniBoss");
    coins.forEach(c=>c.remove());
    logEvent("Monedas limpiadas", true);
  }
  if(event === "rainDiamonds"){
    for(let i=0;i<15;i++){
      const d = document.createElement("div");
      d.className = "diamond";
      d.style.left = Math.random()*90+"vw";
      d.innerText = "üíé";
      d.style.animationDuration = (2 + Math.random()*1) + "s";
      document.body.appendChild(d);
      setTimeout(()=>d.remove(),4000);
    }
    pesos += isAdmin ? 20 : 10;
    diamondSound.play();
    logEvent("Rain Diamonds activado +" + (isAdmin?20:10) + " monedas", isAdmin);
  }
}

// --- Event History ---
function logEvent(msg,isPrivate=false){
  const p = document.createElement("p");
  p.innerText = msg;
  p.className = "eventItem";
  p.onclick = ()=>{ 
    if(msg.includes("Party")) for(let i=0;i<5;i++) crearMoneda("C");
    if(msg.includes("Rain Diamonds")) for(let i=0;i<5;i++) crearMoneda("diamond");
  };
  if(isPrivate) p.style.color="#ff88ff";
  eventHistory.appendChild(p);
  eventHistory.scrollTop = eventHistory.scrollHeight;
}

// --- Infinite Life ---
function toggleInfiniteLife(){
  infiniteLife = !infiniteLife;
  logEvent("Vida infinita " + (infiniteLife?"activada":"desactivada"), true);
  actualizarStats();
}

// --- Owner Messages ---
function ownerMessagePrompt(){
  if(ownerClass!=="ruler") return;
  const msg = prompt("Mensaje Owner:");
  if(msg) showOwnerMessage(msg,3000);
}
function showOwnerMessage(msg,duration=2000){
  ownerMessagesEl.innerText = msg;
  ownerMessagesEl.style.display="block";
  ownerMessagesEl.style.opacity = 0;
  let op = 0;
  const fadeIn = setInterval(()=>{
    if(op<1){ op+=0.05; ownerMessagesEl.style.opacity = op; }
    else clearInterval(fadeIn);
  },20);
  setTimeout(()=>{
    let op2 = 1;
    const fadeOut = setInterval(()=>{
      if(op2>0){ op2-=0.05; ownerMessagesEl.style.opacity = op2; }
      else{ clearInterval(fadeOut); ownerMessagesEl.style.display="none"; }
    },20);
  },duration);
}

// --- Daily Events Simulation ---
function startDailyEvents(){
  setInterval(()=>{
    const events = ["party","rainDiamonds"];
    const e = events[Math.floor(Math.random()*events.length)];
    triggerEvent(e,false);
    showMessage("Evento diario activado: "+e,2500);
  },30000);
}

// --- Messages with Fade ---
function showMessage(msg,duration=2000){
  messagesEl.innerText = msg;
  messagesEl.style.display="block";
  messagesEl.style.opacity = 0;
  let op = 0;
  const fadeIn = setInterval(()=>{
    if(op<1){ op+=0.05; messagesEl.style.opacity = op; }
    else clearInterval(fadeIn);
  },20);
  setTimeout(()=>{
    let op2 = 1;
    const fadeOut = setInterval(()=>{
      if(op2>0){ op2-=0.05; messagesEl.style.opacity = op2; }
      else{ clearInterval(fadeOut); messagesEl.style.display="none"; }
    },20);
  },duration);
}
</script>

</body>
</html>
