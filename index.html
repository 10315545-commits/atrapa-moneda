<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atrapa la Moneda 1.5</title>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#0f0f0f,#1a1a1a);
  color:white;
  font-family:Arial;
  text-align:center;
  overflow:hidden;
}

h1{
  color:#00ffcc;
  text-shadow:0 0 15px #00ffcc;
}

#menu{
  margin-top:80px;
}

button{
  padding:15px 30px;
  font-size:20px;
  background:#00ffcc;
  border:none;
  border-radius:15px;
  cursor:pointer;
}

#game{
  display:none;
}

#zona{
  position:relative;
  width:100%;
  height:300px;
  overflow:hidden;
  margin-top:20px;
  border-top:2px solid #00ffcc;
}

#moneda{
  position:absolute;
  font-size:70px;
  transition: transform 0.15s;
}

#botones{
  position:fixed;
  bottom:20px;
  width:100%;
  display:flex;
  justify-content:space-around;
}

#botones button{
  width:90px;
  height:90px;
  font-size:28px;
  border-radius:20px;
}

.info{
  margin-top:10px;
  font-size:18px;
}
</style>
</head>
<body>

<h1>ðŸŽ® ATRAPA LA MONEDA</h1>

<div id="menu">
  <button onclick="iniciar()">INICIAR</button>
</div>

<div id="game">

  <div id="zona">
    <div id="moneda">ðŸª™</div>
  </div>

  <div class="info" id="stats"></div>

  <div id="botones">
    <button onclick="respuesta('L')">L</button>
    <button onclick="respuesta('C')">C</button>
    <button onclick="respuesta('R')">R</button>
  </div>

</div>

<script>

let pesos = 0;
let vidas = 5;
let record = localStorage.getItem("record") || 0;

let posicionesX = {
  "L": "15%",
  "C": "45%",
  "R": "75%"
};

let secuencia = ["R","L","C","L","R","C","R"];
let indice = 0;

let monedaActual = "";
let velocidadCaida = 2;
let animacion;
let y = -80;

const monedaEl = document.getElementById("moneda");
const statsEl = document.getElementById("stats");

function iniciar(){
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  resetGame();
}

function resetGame(){
  pesos = 0;
  vidas = 5;
  velocidadCaida = 2;
  indice = 0;
  actualizarStats();
  nuevaMoneda();
}

function nuevaMoneda(){
  monedaActual = secuencia[indice];
  monedaEl.style.left = posicionesX[monedaActual];
  y = -80;
  monedaEl.style.top = y + "px";

  indice++;
  if(indice >= secuencia.length){
    indice = 0;
  }

  cancelAnimationFrame(animacion);
  animacion = requestAnimationFrame(caer);
}

function caer(){
  y += velocidadCaida;
  monedaEl.style.top = y + "px";

  if(y > 250){
    perderVida();
    return;
  }

  animacion = requestAnimationFrame(caer);
}

function actualizarStats(){
  statsEl.innerText =
    "Pesos: " + pesos +
    " | Vidas: " + vidas +
    " | RÃ©cord: " + record;
}

function respuesta(eleccion){

  if(eleccion === monedaActual){

    cancelAnimationFrame(animacion);

    pesos++;
    velocidadCaida += 0.3;

    monedaEl.style.transform="scale(1.3)";
    setTimeout(()=>monedaEl.style.transform="scale(1)",150);

    sonidoAcierto();
    nuevaMoneda();

  }else{
    perderVida();
  }

  actualizarStats();
}

function perderVida(){
  cancelAnimationFrame(animacion);
  vidas--;

  sonidoError();

  if(navigator.vibrate){
    navigator.vibrate(200);
  }

  if(vidas <= 0){
    gameOver();
  }else{
    nuevaMoneda();
  }

  actualizarStats();
}

function gameOver(){

  if(pesos > record){
    record = pesos;
    localStorage.setItem("record", record);
  }

  alert("GAME OVER\nPuntaje: " + pesos);
  resetGame();
}

function sonidoAcierto(){
  const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  audio.play();
}

function sonidoError(){
  const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg");
  audio.play();
}

document.addEventListener("keydown", function(e){
  const tecla = e.key.toUpperCase();
  if(["L","C","R"].includes(tecla)){
    respuesta(tecla);
  }
});

</script>

</body>
</html>
